# Support Tile: Before vs After

## Visual Design Changes

### BEFORE (Heavy Styling)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üõü Support Overview                ‚îÇ
‚îÇ Recent tickets & sentiment          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚îÇ ‚Üê Heavy blue background
‚îÇ ‚ïë Open Tickets                  ‚ïë ‚îÇ
‚îÇ ‚ïë 5                             ‚ïë ‚îÇ
‚îÇ ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚îÇ ‚Üê Heavy orange background
‚îÇ ‚ïë Active Escalations            ‚ïë ‚îÇ
‚îÇ ‚ïë 3                             ‚ïë ‚îÇ
‚îÇ ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚îÇ ‚Üê Gray background
‚îÇ ‚ïë Avg. Sentiment                ‚ïë ‚îÇ
‚îÇ ‚ïë Positive                      ‚ïë ‚îÇ
‚îÇ ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚îÇ
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Issues:**
- ‚ùå Heavy colored backgrounds (blue-50, orange-50)
- ‚ùå Different from other tiles
- ‚ùå Mock sentiment data (hardcoded 0.75)
- ‚ùå Inconsistent spacing
- ‚ùå No time range indicator

---

### AFTER (Clean Design)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üõü Support Overview                ‚îÇ
‚îÇ Last 30 days                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ Open Tickets          View all ‚Üí   ‚îÇ ‚Üê Clean layout
‚îÇ 5                                   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ Active Escalations    View all ‚Üí   ‚îÇ ‚Üê Clean layout
‚îÇ 3                                   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ Avg. Sentiment                      ‚îÇ ‚Üê Clean layout
‚îÇ Positive (82% positive)             ‚îÇ
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Improvements:**
- ‚úÖ Clean white background (matches other tiles)
- ‚úÖ Consistent typography and spacing
- ‚úÖ Real sentiment data from BigQuery
- ‚úÖ Time range clearly indicated ("Last 30 days")
- ‚úÖ Subtle "View all" links for drill-down
- ‚úÖ Percentage shown alongside sentiment label

---

## Data Changes

### BEFORE
```typescript
// Mock sentiment
const avgSentiment = 0.75; // ‚ùå Hardcoded mock data
```

### AFTER
```typescript
// Real sentiment from BigQuery smiley ratings
const ticketsWithRatings = ticketsData.filter((t: any) => t.has_smiley_rating);
const positiveCount = ticketsWithRatings.filter((t: any) => t.has_positive_smiley_rating).length;
const neutralCount = ticketsWithRatings.filter((t: any) => t.has_neutral_smiley_rating).length;

// Weighted calculation: positive = 1.0, neutral = 0.5, negative = 0
avgSentiment = (positiveCount * 1.0 + neutralCount * 0.5) / ticketsWithRatings.length;
```

**Data Source:**
- ‚úÖ `shopify-dw.support.support_tickets_summary`
- ‚úÖ Real merchant smiley ratings
- ‚úÖ Last 30 days of data
- ‚úÖ No mock fallbacks

---

## Consistency with Other Tiles

### Attainment Card Pattern
```
Open Tickets          View all ‚Üí    ‚Üê Matches this pattern
5
```

### Product Adoption Card Pattern
```
Shopify Payments      45 of 50      ‚Üê Similar label + metric
[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 90%
```

### Support Card (Updated)
```
Open Tickets          View all ‚Üí    ‚Üê Follows same pattern
5
```

**All tiles now share:**
- Same heading style (Icon + Title)
- Same subtitle pattern (description or time range)
- Same metric layout (label on top, large number below)
- Same spacing (space-y-4)
- Same typography scale

---

## Metric Calculation Logic

### Open Tickets
```typescript
// Count tickets with status 'open' or 'pending'
const openTickets = tickets.filter(t => 
  t.status.toLowerCase() === 'open' || 
  t.status.toLowerCase() === 'pending'
).length;
```

### Active Escalations
```typescript
// Count ACTIVE escalated tickets only (not resolved)
const activeEscalations = tickets.filter(t => 
  t.escalated && 
  (t.status.toLowerCase() === 'open' || t.status.toLowerCase() === 'pending')
).length;
```
**Changed:** Now only shows escalations that are still active, not all historical escalations.

### Average Sentiment
```typescript
// Real sentiment calculation from smiley ratings
if (ticketsWithRatings.length > 0) {
  const positiveCount = ticketsWithRatings.filter(t => t.has_positive_smiley_rating).length;
  const neutralCount = ticketsWithRatings.filter(t => t.has_neutral_smiley_rating).length;
  
  // Weighted: positive=1.0, neutral=0.5, negative=0.0
  avgSentiment = (positiveCount * 1.0 + neutralCount * 0.5) / ticketsWithRatings.length;
}
```

**Color Thresholds:**
- üü¢ Green (>= 70%): Positive sentiment
- üü° Yellow (40-69%): Neutral sentiment  
- üî¥ Red (< 40%): Negative sentiment

---

## Interactive Features

### Popover Details
Both "Open Tickets" and "Active Escalations" are clickable and show:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Open Tickets                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Nutrition Warehouse             ‚îÇ
‚îÇ Payment Processing              ‚îÇ
‚îÇ View in Zendesk ‚Üí              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Sistaco UK: SPI                 ‚îÇ
‚îÇ Account Setup                   ‚îÇ
‚îÇ View in Zendesk ‚Üí              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ... (up to 10 tickets)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Features:**
- Shows merchant name
- Shows ticket category
- Direct link to Zendesk
- Scrollable if > 10 tickets
- Empty state handling

---

## Time Range

### Query Filter
```sql
WHERE created_at >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 30 DAY)
```

**Why 30 days?**
- ‚úÖ Recent enough to be actionable
- ‚úÖ Not too much data to process
- ‚úÖ Aligns with typical MSM review cycle
- ‚úÖ Provides meaningful sentiment sample size

---

## Error Handling

### States Handled
1. **Loading**: "Loading..."
2. **Error**: "Error: {message}"
3. **No Data**: "No data available"
4. **Empty Tickets**: Shows 0 with proper UI
5. **No Ratings**: Shows sentiment as 0 (not mock)

### No Mock Fallbacks
Per memory [[10102292]]:
- ‚ùå No fake data when API fails
- ‚úÖ Clear error messages
- ‚úÖ Distinguishable from real issues

---

## Summary

| Aspect | Before | After |
|--------|--------|-------|
| **Background Colors** | Heavy (blue-50, orange-50) | Clean (white) |
| **Sentiment Data** | Mock (0.75) | Real (BigQuery) |
| **Typography** | Inconsistent | Matches other tiles |
| **Spacing** | Mixed | Consistent (space-y-4) |
| **Time Range** | Not shown | "Last 30 days" |
| **Escalations** | All historical | Active only |
| **Error States** | Basic | Comprehensive |
| **Visual Weight** | Heavy | Light |

**Result:** Support tile now seamlessly integrates with the rest of the dashboard! ‚ú®

